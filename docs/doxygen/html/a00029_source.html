<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cgtfs: docs/doxygen/static/api_overview.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cgtfs
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   <div id="projectbrief">a C library to read static GTFS feeds</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">docs/doxygen/static/api_overview.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00029.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# API (brief) overview {#api_overview}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;If you are looking for a very brief introduction, @ref data_transition &quot;data transition guide&quot; might be a better starting point. However, having gone through this file would prove highly benefitial when using the library.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;@section ApiOverview__Introduction Basics</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;The library tries to provide a semantic, consistent and readable interface. The following diagrams show the ways GTFS data can be parsed or transferred between different storage types using this library.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;_Note: **bold arrows** indicate that such a function exists in the API which makes it possible to transfer the entire contents of a feed between two types of storage with a single function call (not counting the setup and teardown functions)._</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;div style=&quot;text-align: center;&quot;&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;div style=&quot;display: inline-block; width: 100%; max-width: 500px; padding-right: 5%;&quot;&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;@image html df_straight.svg &quot;Ways to parse/tranport data with CGTFS (simple diagram)&quot; width=100%</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;div style=&quot;display: inline-block; width: 100%; max-width: 400px;&quot;&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;@image html df_scheme.svg &quot;Ways to parse/tranport data with CGTFS (scheme)&quot; width=100%</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;@image latex df_straight.eps &quot;Ways to parse/tranport data with CGTFS (simple diagram)&quot; width=12cm</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;@image latex df_scheme.eps &quot;Ways to parse/tranport data with CGTFS (scheme)&quot; width=12cm</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;@subsection ApiOverview__Introduction__Terms Terms</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The terms used throughout the library code and documentation differ from those defined by the [GTFS reference](https://developers.google.com/transit/gtfs/reference/#term-definitions). The following table illustrates the relation between differing CGTFS terms and reference terms, and their definitions, as well as terms used in the library and abscent from the reference.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;| CGTFS term | Reference term | Meaning and notes |</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;| ---------- | -------------- | ----------------- |</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;| Feed (entity/instance/object) | *not defined* | A data structure holding the entirety of a feed&#39;s data. *In the code and documentation, may be referred to as a feed entity, feed instance or feed object.* |</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;| Directory | Dataset | A set of files which constitutes a GTFS feed. In some contexts, in the code documentation, terms *feed* and *directory* are interchangable. *Note: GTFS datasets are distributed in form of `*.zip` feed archives. This library, however, only works with unpacked feeds.* |</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;| Entity (instance) | Record | A complete data structure containing information about a concrete GTFS entity (e.g. information about one route). The library uses the term *entity* to avoid ambiguity with database operations. _Note: however, *entity* is a more abstract term, thus a struct holding one entity&#39;s data is, in essense, an entity instance. This documentation may refer to structs simply as **entities** for shortness_. |</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;| File | *not defined* | A `*.txt` file, a part of the feed, holding information about all the feed&#39;s *entities* of a single type. |</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;| Database | n/a | A single *SQLite* database file, created using the supplied SQL schema (preferably, the creation of the database is left to the library, see the database section). |</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;@section ApiOverview__Principles Principles</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;There are several core principles which could help in understanding the vast interface of the library. Some of them have been enforced from the beginning, others may be gradually integrated into the API.</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  - All structs and enumerations have names ending with `_t`.</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  - All enumerations have members with names reflecting the enumeration&#39;s name.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    - Entity field enumerations start with the first letters of the enumeration&#39;s name, e.g. `payment_method_t` has elements `PM_ON_BOARD`, `PM_BEFOREHAND` and `PM_NOT_SET`.</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      - There are exceptions at naming conflicts, e.g. `pathway_mode_t`, which would have to start its members&#39; names with `PM` but uses `PTMD` instead.</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      - Additionally, all entity field enumerations have `..._NOT_SET` members.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  - All structs have `init_...()` functions for initializing them. These functions MUST be called before the first use of the structure.</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    - Feed entity and record entity structs also have `read_...()` and `equal_...()` functions.</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    - Structs which need deallocation after use have `free_...()` functions.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  - All functions which have to do something with database operations have `_db` postfix.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;@section ApiOverview__Strings String storage</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;String values in CGTFS are stored in memory using statically allocated c-strings. Hence, parsing an unsually long string value may lead to a fatal crash. Default string field lengths are rather sensible but might by too big (bloating the RAM used significantly) or too small (causing crash).</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;To mitigate that, all string field length definitions are located in the `xstrlengths.h` header. Actual field length definitions are heavily commented in the lower part of the file. By default, they are using `CGTFS_SL_BASE_` definitions found in the upper part of the file. There are three possible usage cases:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  1. All left as it is in hopes for lucky circumstances.</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  2. Definition `CGTFS_SL_MODE_PREPARATION` is uncommented, reserving an obstinate amount of memory for all fields.</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  3. Maximum length of each field type is deduced from the supposed data sources (useful if you&#39;re working with the data form a specific agency). This is left to the developer.</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;@section ApiOverview__Structure Structure</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;The library&#39;s API is divided into two so called layers, additional auxiliary functionality and loosely related helpers:</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  - @ref Core &quot;Core layer&quot; provides basic definitions and functions for handling GTFS feeds and entities, and includes:</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    - @ref Core__FeedEntity &quot;feed object definition&quot; to store data of an entire feed and functions for working with it:</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      - a function to initialize a feed object;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      - a function to parse a feed object from a given directory path;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      - a function to determine whether two feed objects are equal;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    - field enumerations to represent types and values of the fields which can only take values from a limited set defined by the specification, e.g. [`routes.txt/route type`](https://developers.google.com/transit/gtfs/reference/#routestxt);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      - functions to parse field enumeration values from a char array;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    - @ref Core__EntityTypes &quot;entity definitions&quot; to represent e.g. an agency, a stop, a shape, etc. and @ref Core__EntityList &quot;functions&quot; for handling them;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      - functions to initialize entity instances;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      - functions to parse entity instances from a char array of field names and a char array of field values;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      - functions to determine whether two entity instances are equal;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    - @ref Core__EntityFileReading &quot;batch entity parsing functions&quot; which parse an array of entities from a given `*.txt` file path;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  - @ref Database &quot;Database layer&quot; provides definitions and functions for working with entities defined in the *core layer* with/through/in a SQLite database instance, and includes:</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    - @ref feed_db_t &quot;definition of a connection to a sqlite database&quot; and @ref Database__FeedEntity &quot;functions&quot; for working with it:</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      - a function to initialize a database connection;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      - a function to free/close a database connection;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      - a function to setup a database at an opened connection for a GTFS feed;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    - storage transition functions:</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      - a @ref import_feed_db &quot;function&quot; to &lt;strong&gt;semantically&lt;/strong&gt; store the contents of a feed from a specified directory into a specified database connection (see note below);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      - a @ref store_feed_db &quot;function&quot; to &lt;strong&gt;non-semantically&lt;/strong&gt; store the contents of a feed from a specified directory into a specified database connection (see note below);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      - a @ref fetch_feed_db &quot;function&quot; to fetch the contents of a feed from a specified database connection into a specicfied feed object;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    - an @ref feed_db_status_t &quot;enumeration&quot; of general database operation results (success / failure / so-so);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    - @ref Database__EntityStoring &quot;functions&quot; to store entities using a specified database connection;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    - the so-called table operations:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      - @ref Database__TableStoring &quot;batch entity storing functions&quot; which parse an array of entities from a given `*.txt` file path into a database table (doing so directly, without keeping an intermediate array in the memory);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      - @ref Database__TableFetching &quot;batch entity fetching functions&quot; which retrieve an array of entities of a single type from a specified database connection;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  - @ref Utilities &quot;Utilities&quot; include:</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    - @ref Utilities__File &quot;functions&quot; for reading CSV files;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    - an assisting @ref Utilities__Memory &quot;function&quot; for clearing a c-string array;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    - utilitary @ref Utils__Database &quot;functions&quot; for working a with sqlite database;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  - @ref Helpers &quot;Helpers&quot; include:</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    - several preprocessor definitions used across the library;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    - a @ref get_filename_no_ext &quot;function&quot; for extracting filename without extension from a given path;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    - a @ref make_filepath &quot;function&quot; for making a filepath from a directory and a file in it;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    - a @ref dg_to_rad &quot;function&quot; for converting degrees into radians;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    - a @ref geo_location_t &quot;geolocation definition&quot; which holds a latitude value and a longitude value;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      - a @ref haversine_distance &quot;function&quot; for calculating a distance (in meters) between the two geolocation points.</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;_Note: CGTFS provides two ways of parsing a directory into a database, semantic and non-semantic. Semantic stores all values according to the specification, creating a reference-defined database layout and filling it with data of according types. Non-semantic directly translates GTFS *.txt files as CSVs into the database, creating a layout based on file headers and storing all data as text. See more in the related documentation page._</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;_Another note: up to release `1.0.0`, the library&#39;s API is a subject to a change without backwards-compatibility concerns._</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;A more detailed documentation for each layer, definition and function can be found in the module documentation, linked throughout the list.</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;@section ApiOverview__Examples Examples</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;Some example source code is located in the `examples/` folder of the library&#39;s source code. Digging into the `tests/` folder might as well be useful.</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;@subsection ApiOverview__Examples__0 Reading a feed into memory</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;Usage shown in this example is not recommended for parsing a real feed, as it **will** take **a lot of** memory for any substantially big amounts of data.</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;@include example_0.c</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;@subsection ApiOverview__Examples__1 An entity file reading</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;Read all bus stops and print out their information</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;@include example_1.c</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;@subsection ApiOverview__Examples__2 Database-backed querying</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;Store a gtfs folder as a database and query it for first 10 stop time records with arrival time within the next 10 minutes.</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;@include example_2.c</div></div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<address class="footer">
  <small class="desc">
    cgtfs 0.5.0 &mdash; documentation generated by <span title="on Fri Aug 16 2019 01:04:59">Doxygen 1.8.13</span>
  </small>
  <small class="links">
    <a target="_blank" href="https://rakhack.github.io/cgtfs/" title="A pretty empty website \_(*^*)_/">Website</a>&mdash;
    <a target="_blank" href="https://github.com/rakhack/cgtfs" title="Main development platform & source code repository">GitHub</a>&mdash;
    <a target="_blank" href="https://raw.githubusercontent.com/rakhack/cgtfs/master/LICENSE" title="Library code">MIT License</a>&mdash;
    <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/" title="Documentation and related materials">CC BY 4.0</a>
  </small>
</address>
</body>
</html>
