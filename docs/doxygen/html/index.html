<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cgtfs: CGTFS - a C library to read static GTFS feeds</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cgtfs
   &#160;<span id="projectnumber">0.3.0-dev</span>
   </div>
   <div id="projectbrief">a C library to read static GTFS feeds</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CGTFS - a C library to read static GTFS feeds </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A thin and fast low-level library which reads GTFS static feeds. This library provides a readable and intuitive C interface for parsing data provided in the Google's <a href="https://developers.google.com/transit/gtfs/">General Transit Feed Specification</a> format.</p>
<h2>Examples</h2>
<p>Some example source code is located in the <code>examples/</code> folder of the library's source code. Digging into the <code>tests/</code> folder might as well be useful.</p>
<h3>Reading a feed into memory</h3>
<p><em>Note: usage shown in this example is not recommended for parsing a real feed, as it <b>will</b> take <b>a lot of</b> memory for any substantially big amounts of data.</em></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a01208.html">feed.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Example 0: read all feed data into memory</span></div><div class="line"><span class="keywordtype">void</span> some_function(<span class="keywordtype">void</span>) {</div><div class="line">    <a class="code" href="a01236.html#a01270">feed_t</a> amazing_feed;</div><div class="line">    <a class="code" href="a01236.html#ga9decb9ade6fdf69c1c54d33d0eba0225">init_feed</a>(&amp;amazing_feed);</div><div class="line">    <a class="code" href="a01236.html#ga2994e392bb1b1c47a217865140f43d64">read_feed</a>(&amp;amazing_feed, <span class="stringliteral">&quot;../tests/data/google_sample&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (amazing_feed.<a class="code" href="a01236.html#a6364353779db84f8f26549d78ab1e2e7">agency_count</a> &gt; 0)</div><div class="line">        printf(<span class="stringliteral">&quot;The agency&#39;s name is: %s \n&quot;</span>, amazing_feed.<a class="code" href="a01236.html#a66ec2e3ec7d861e13f8b9abb132d994f">agencies</a>[0].<a class="code" href="a01238.html#a77d15cd529046a64047275e763627bcc">name</a>);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        perror(<span class="stringliteral">&quot;Failed to open agency.txt or the file has no records&quot;</span>);</div><div class="line">    </div><div class="line">    <a class="code" href="a01208.html#ad506bf45c542373ff523f80dd7ab8491">free_feed</a>(&amp;amazing_feed);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    some_function();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3>An entity file reading</h3>
<p>Read all bus stops and print out their information</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a01214.html">helpers/filenames.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a01226.html">reading.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Example 1: read all bus stops into memory</span></div><div class="line"><span class="keywordtype">void</span> another_function(<span class="keywordtype">void</span>) {</div><div class="line">    <span class="keywordtype">char</span> *stops_filename;</div><div class="line">    <a class="code" href="a01235.html#gae2bbdb842d112551febe520ce94152a4">make_filepath</a>(&amp;stops_filename, <span class="stringliteral">&quot;../tests/data/google_sample&quot;</span>, <span class="stringliteral">&quot;stops.txt&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> stops_count = 0;</div><div class="line">    <a class="code" href="a01238.html#a01314">stop_t</a> *stops;</div><div class="line"></div><div class="line">    FILE *fp = fopen(stops_filename, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> (fp) {</div><div class="line">        stops_count = <a class="code" href="a01240.html#ga837f7f0ef7f0fcd5f300e1dc8e3f4c34">read_all_stops</a>(fp, &amp;stops);</div><div class="line">        fclose(fp);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; stops_count; i++) {</div><div class="line">        printf(<span class="stringliteral">&quot;=== Stop %i:\n&quot;</span>, i + 1);</div><div class="line">        printf(<span class="stringliteral">&quot; -&gt; stop_id == %s\n&quot;</span>, stops[i].<span class="keywordtype">id</span>);</div><div class="line">        printf(<span class="stringliteral">&quot; -&gt; stop_name == %s\n&quot;</span>, stops[i].name);</div><div class="line">        printf(<span class="stringliteral">&quot; -&gt; stop_lat == %Lf\n&quot;</span>, stops[i].lat);</div><div class="line">        printf(<span class="stringliteral">&quot; -&gt; stop_lon == %Lf\n&quot;</span>, stops[i].lon);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (stops_count &gt; 0) free(stops);</div><div class="line">    free(stops_filename);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    another_function();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3>Database-backed querying</h3>
<p>Store a gtfs folder as a database and query it for first 10 stop time records with arrival time within the next 10 minutes.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a01208.html">feed.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a01151.html">database/database.h</a>&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> row_callback(<span class="keywordtype">void</span> *, <span class="keywordtype">int</span> column_count, <span class="keywordtype">char</span> **data, <span class="keywordtype">char</span> **column_names);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *row_format = <span class="stringliteral">&quot;  %-8s | %-12s\n&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *sql_query = </div><div class="line">    <span class="stringliteral">&quot;SELECT stop_id, arrival_time &quot;</span></div><div class="line">    <span class="stringliteral">&quot;FROM stop_times &quot;</span></div><div class="line">    <span class="stringliteral">&quot;WHERE arrival_time &quot;</span></div><div class="line">        <span class="stringliteral">&quot;BETWEEN time(&#39;now&#39;, &#39;localtime&#39;) &quot;</span></div><div class="line">        <span class="stringliteral">&quot;AND time(&#39;now&#39;, &#39;+10 minutes&#39;, &#39;localtime&#39;) &quot;</span></div><div class="line">    <span class="stringliteral">&quot;LIMIT 10;&quot;</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Example 2: </span></div><div class="line"><span class="comment">//   Store gtfs folder as a database and</span></div><div class="line"><span class="comment">//   query it for first 10 stop_time records</span></div><div class="line"><span class="comment">//   with arrival time within the next 10 minutes.</span></div><div class="line"><span class="keywordtype">void</span> some_database_manipulation(<span class="keywordtype">void</span>) {</div><div class="line">    <span class="keywordtype">char</span> *error_msg = NULL;</div><div class="line"></div><div class="line">    <a class="code" href="a01254.html#a01266">feed_db_t</a> database;</div><div class="line">    <a class="code" href="a01254.html#ga45782c8787f0d20ee77ef2cccefb87d5">feed_db_status_t</a> result;</div><div class="line"></div><div class="line">    result = <a class="code" href="a01255.html#ga13d4d9a2e28efa18ea54f551121239c2">init_feed_db</a>(&amp;database, <span class="stringliteral">&quot;example2.db&quot;</span>, 1);</div><div class="line">    <span class="keywordflow">if</span> (result &lt; <a class="code" href="a01254.html#gga45782c8787f0d20ee77ef2cccefb87d5af14bbd458e276ae6173f2327ef8a8406">FEED_DB_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to create/open a test database: %s !\n&quot;</span>, database.<a class="code" href="a01254.html#aff3d69d17c4ad1a88762c7370178e92a">error_msg</a>);</div><div class="line">        <span class="keywordflow">goto</span> clearup;</div><div class="line">    }</div><div class="line"></div><div class="line">    result = <a class="code" href="a01255.html#gae39e256c548593a4e4835b0676adae25">setup_feed_db</a>(&amp;database, 0);</div><div class="line">    <span class="keywordflow">if</span> (result &lt; <a class="code" href="a01254.html#gga45782c8787f0d20ee77ef2cccefb87d5af14bbd458e276ae6173f2327ef8a8406">FEED_DB_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to create the layout of the test database: %s !\n&quot;</span>, database.<a class="code" href="a01254.html#aff3d69d17c4ad1a88762c7370178e92a">error_msg</a>);</div><div class="line">        <span class="keywordflow">goto</span> clearup;</div><div class="line">    }</div><div class="line"></div><div class="line">    result = <a class="code" href="a01255.html#ga6ab599038ba2cf94a5458f1aeb2552ff">store_feed_db</a>(<span class="stringliteral">&quot;../tests/data/pocono_pony&quot;</span>, &amp;database, NULL);</div><div class="line">    <span class="keywordflow">if</span> (result &lt; <a class="code" href="a01254.html#gga45782c8787f0d20ee77ef2cccefb87d5af14bbd458e276ae6173f2327ef8a8406">FEED_DB_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to store a test gtfs directory: data/pocono_pony: %s !\n&quot;</span>, database.<a class="code" href="a01254.html#aff3d69d17c4ad1a88762c7370178e92a">error_msg</a>);</div><div class="line">        <span class="keywordflow">goto</span> clearup;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    printf(row_format, <span class="stringliteral">&quot;stop_id&quot;</span>, <span class="stringliteral">&quot;arrival_time&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;  --------   ------------\n&quot;</span>);</div><div class="line"></div><div class="line">    database.<a class="code" href="a01254.html#aad0139c08f6e31a66e145a019b1e0437">rc</a> = sqlite3_exec(database.<a class="code" href="a01254.html#af18818af8f19ecda563bad15478074de">conn</a>, sql_query, row_callback, NULL, &amp;error_msg);</div><div class="line">    <span class="keywordflow">if</span> (error_msg != NULL) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error while executing query: %s !\n&quot;</span>, error_msg);</div><div class="line">        <span class="keywordflow">goto</span> clearup;</div><div class="line">    }</div><div class="line">    </div><div class="line">    printf(<span class="stringliteral">&quot;Success.\n&quot;</span>);</div><div class="line"></div><div class="line">    clearup:</div><div class="line">    sqlite3_free(error_msg);</div><div class="line">    <a class="code" href="a01255.html#ga038548ff3d3967beaa634cc65a107f3e">free_feed_db</a>(&amp;database);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> row_callback(<span class="keywordtype">void</span> *param, <span class="keywordtype">int</span> column_count, <span class="keywordtype">char</span> **data, <span class="keywordtype">char</span> **column_names) {</div><div class="line">    <span class="keywordflow">if</span> (column_count &lt; 2)</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    </div><div class="line">    printf(row_format, data[0], data[1]);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    some_database_manipulation();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Build process and dependencies</h2>
<h3>Dependencies</h3>
<p>One of the development goals was to keep the dependencies as minimal as possible. So far, CGTFS has following dependencies:</p>
<ul>
<li><a href="https://github.com/silentbicycle/greatest">greatest</a> for tests</li>
<li><a href="https://www.sqlite.org/index.html">sqlite3</a> for fast &amp; efficient querying <em>built through <a href="https://github.com/rakhack/sqlite3-cmake">a special cmake-friendly repo</a></em></li>
</ul>
<h3>Build process</h3>
<p>The library should compile on <code>gcc &gt;= 4.8.4</code>, <code>clang &gt;= 5.0.0</code> and latest Microsoft's C/C++ compiler.</p>
<div class="fragment"><div class="line">$ cd /path/to/cgtfs/</div><div class="line">$ git submodule update --init --recursive</div><div class="line">$ mkdir build &amp;&amp; cd build/</div><div class="line">$ cmake -DCMAKE_BUILD_TYPE=Release ..    # produces an optimized &amp; stripped binary without debug symbols, use Debug for development</div><div class="line">$ cmake --build .</div><div class="line"></div><div class="line">$ ./tests    # on Linux; tests executable location on Windows may vary, e.g. Release/tests.exe</div></div><!-- fragment --><h2>Documentation</h2>
<p>The library is heavily documented via code comments. You are encouraged to compile them into HTML.</p>
<div class="fragment"><div class="line">$ doxygen</div></div><!-- fragment --><p><em>Note: by default, doxygen is configured to output LaTeX documentation as well. Turn off LaTeX if it is not installed on your system. (./Doxyfile:1648)</em></p>
<p><em>Note 2: this file is not guaranteed to contain up-to-date information. It is advised that you download the latest release and compile doxygen documentation from its source.</em></p>
<h3>API overview</h3>
<p>An overview of the library's interface is provided in a separate section. See <a class="el" href="a01327.html">API (brief) overview</a>.</p>
<h2>Useful links</h2>
<ul>
<li><a href="https://developers.google.com/transit/gtfs/reference/">Official GTFS static reference</a></li>
<li><a href="https://github.com/CUTR-at-USF/awesome-transit#gtfs-libraries">Other GTFS handling libraries</a></li>
</ul>
<h2>License and attribution</h2>
<p>The library is developed and distributed under the <a class="el" href="a01328.html">MIT License</a>, a copy of which can be found in the root of the project's source code. Documentation and materials other than the library's source code are distributed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>.</p>
<p>Files under the <code>tests/data/google_sample</code> directory constitute <a href="https://developers.google.com/transit/gtfs/examples/gtfs-feed">an example Google Transit Feed</a> created and <a href="https://developers.google.com/readme/policies/">shared by Google</a> and are used according to terms described in the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution License</a>. <em>Additionaly, parts of the in-code documentation may contain pieces of the <a href="https://developers.google.com/transit/gtfs/reference/">GTFS reference</a>.</em></p>
<p>Files under the <code>tests/data/pocono_pony</code> contain the open data publicly provided by <a href="https://www.gomcta.com/index.php">Monroe County Transportation Authority</a> under the <a href="https://www.gomcta.com/developerapi.php">Monroe County Transportation Authority Transit Data Developer Terms of Use</a>.</p>
<p>Other files under the <code>tests/data</code> directory may contain elements of the <a href="http://www.lsl.fi/lisatietoa/avoin-data/">open data</a> publicly provided by <a href="http://www.lsl.fi/">Lahden Seudun Liikenne</a> under the <a href="https://creativecommons.org/licenses/by/4.0/deed.fi">Creative Commons Attribution 4.0 License</a>.</p>
<p>Usage of the public data provided by Google, Monroe County Transportation Authority and Lahden Seudun Liikenne does not suggest endorsement by any of the aforementioned licensors. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<address class="footer">
  <small class="desc">
    cgtfs 0.3.0-dev &mdash; documentation generated by <span title="on Sat Jul 6 2019 18:11:35">Doxygen 1.8.13</span>
  </small>
  <small class="links">
    <a target="_blank" href="#" title="Has yet to be created \_(*^*)_/">Website</a>&mdash;
    <a target="_blank" href="https://github.com/rakhack/cgtfs" title="Main development platform & source code repository">GitHub</a>&mdash;
    <a target="_blank" href="https://raw.githubusercontent.com/rakhack/cgtfs/master/LICENSE" title="Library code">MIT License</a>&mdash;
    <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/" title="Documentation and related materials">CC BY 4.0</a>
  </small>
</address>
</body>
</html>
